import machine, kooka
import time
import framebuf
import random

eye_x = None
eye_y = None
size = None
open2 = None
mouth_x = None
mouth_y = None
mouth_width = None
mouth_height = None
eye_height = None
face_midline = None
eye_open = None
eyeline = None
blink = None
eyesize = None
mouthline = None

Number = (bool, int, float)

# Draws an eye centred on x,y with given size and height
# proportioned on scale 0 to 10 (bounds not checked)
def eye(eye_x, eye_y, size, open2):
    global mouth_x, mouth_y, mouth_width, mouth_height, eye_height, face_midline, eye_open, eyeline, blink, eyesize, mouthline
    eye_height = size * (open2 / 10)
    kooka.display.fill_rect(int(eye_x - eyesize / 2), int(eyeline - eye_height / 2), int(size), int(eye_height), int(1))

# Draws the mouth centred on x,y with given width and height
def mouth(mouth_x, mouth_y, mouth_width, mouth_height):
    global eye_x, eye_y, size, open2, eye_height, face_midline, eye_open, eyeline, blink, eyesize, mouthline
    kooka.display.rect(int(mouth_x - mouth_width / 2), int(mouth_y - mouth_height / 2), int(mouth_width), int(mouth_height), int(1))



kooka.display.show()

# Initialise timer counters.
_timer200 = time.ticks_ms()
_timer10000 = time.ticks_ms()
_timer15000 = time.ticks_ms()
_timer800 = time.ticks_ms()

# On-start code, run once at start-up.
if True:
    # Demo of animated face on the Kookaberry display
    face_midline = 63
    eyeline = 20
    eyesize = 20
    eye_open = 5
    mouthline = eyeline * 2 + 10
    mouth_width = random.randint(40, 80)
    mouth_height = random.randint(4, 10)
    blink = False

# Main loop code, run continuously.
while True:
    if time.ticks_diff(time.ticks_ms(), _timer200) >= 0:
        _timer200 += 200
        kooka.display.clear()
        # Left eye
        eye(face_midline - 30, eyeline, eyesize, eye_open)
        # Right eye
        eye(face_midline + 30, eyeline, eyesize, eye_open)
        mouth(face_midline, mouthline, mouth_width, mouth_height)
        # Nose
        kooka.display.blit(framebuf.FrameBuffer(bytearray(b"\x00\x00\x18\x3c\x66\xc3\x81\x00"), 8, 8, framebuf.MONO_HMSB), int(face_midline - 4), int(eyeline * 2 + -12))
        # Vary eye and mouth sizes
        eye_open = (eye_open if isinstance(eye_open, Number) else 0) + random.randint(-1, 1)
        eye_open = min(max(eye_open, 1), 10)
        mouth_height = (mouth_height if isinstance(mouth_height, Number) else 0) + random.randint(-1, 1)
        mouth_height = min(max(mouth_height, 2), 20)
        mouth_width = (mouth_width if isinstance(mouth_width, Number) else 0) + random.randint(-1, 1)
        mouth_width = min(max(mouth_width, 20), 80)
        # Eye reopen after blink
        if blink:
            eye_open = random.randint(4, 10)
            blink = False
    if time.ticks_diff(time.ticks_ms(), _timer10000) >= 0:
        _timer10000 += 10000
        # Blink
        eye_open = 1
        blink = True
    if time.ticks_diff(time.ticks_ms(), _timer15000) >= 0:
        _timer15000 += 15000
        # Shut mouth
        mouth_height = 2
    if time.ticks_diff(time.ticks_ms(), _timer800) >= 0:
        _timer800 += 800
        # Vary direction of gaze
        face_midline = (face_midline if isinstance(face_midline, Number) else 0) + random.randint(-1, 1)
        face_midline = min(max(face_midline, 53), 73)
    if kooka.button_a.was_pressed():
        raise SystemExit
    if kooka.button_b.is_pressed():
        # Shut eyes
        eye_open = 1
        blink = True
    if kooka.button_c.was_pressed():
        # Close and iden mouth
        mouth_height = 2
        mouth_width = 60
    if kooka.button_d.was_pressed():
        # Open and narrow mouth
        mouth_height = 10
        mouth_width = 30
    kooka.display.show()
    machine.idle()

# Generated Blockly XML follows
# <xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="9Tpw+$=0;Xfr+/Ai74;z">eye_x</variable><variable id="d^XSX$WxYd6}37G^bX)2">eye_y</variable><variable id="qM^|,5)KWdBlTMfN$@fl">size</variable><variable id="T{^.tTnN)^y#CZ_rl)yH">open</variable><variable id="Aj`^$Vtd:l01Uf%/juJx">mouth_x</variable><variable id="a,~k2=n`Wu9ZY8}7:!J|">mouth_y</variable><variable id="-cBD?D[O-K`jKumv{qdB">mouth_width</variable><variable id="C#5V|8O/55}3:DRqpnpW">mouth_height</variable><variable id="Y`t|o([`J-Q@%j;JZsXt">eye_height</variable><variable id="G[5ha:Ck}e,Itu,wcpP6">face_midline</variable><variable id="v2J~`+U)~_X|nXPga9@}">eye_open</variable><variable id="/5^,BEX?]n+UK+fC34ib">eyeline</variable><variable id="wRjQ3Psu+M-$]}Zr(#fb">blink</variable><variable id=":jB_!2oRo[fS2+yeTV^J">eyesize</variable><variable id="(f9*,gCVb%EBtX|vS4GY">mouthline</variable></variables><block type="event_every_seconds" id=";Fxt=[#U3nsj]$Q@Do42" x="450" y="-450"><field name="T">0.2</field><statement name="DO"><block type="display_clear" id="^o9pd+KZLde?QUXclk.("><next><block type="py_stmt" id="Ph()7=cU?~fLSJ=G1Ak*"><field name="STMT"># Left eye</field><next><block type="procedures_callnoreturn" id="RHe3x]2p$~jIO-a%SXF?"><mutation name="eye"><arg name="eye_x"></arg><arg name="eye_y"></arg><arg name="size"></arg><arg name="open"></arg></mutation><value name="ARG0"><block type="math_arithmetic" id="/u3p5NS`TP3z0ip!HSDP"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="hKa{kL+UZpTK7,^QcN;)"><field name="NUM">1</field></shadow><block type="variables_get" id="2j9tfLEAM}kL{i}h~[9m"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field></block></value><value name="B"><shadow type="math_number" id="2#nlB|9,Dxe}ael]xax_"><field name="NUM">30</field></shadow></value></block></value><value name="ARG1"><block type="variables_get" id="cW!~KM!}~NTC)%~~QcxW"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field></block></value><value name="ARG2"><block type="variables_get" id="r*gwZAn}j|S5A!jWuC1Y"><field name="VAR" id=":jB_!2oRo[fS2+yeTV^J">eyesize</field></block></value><value name="ARG3"><block type="variables_get" id="h:4vX4X?6!dEK!4z6-qO"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field></block></value><next><block type="py_stmt" id="QrtuW.d7GLbRZ/v5kSH:"><field name="STMT"># Right eye</field><next><block type="procedures_callnoreturn" id="BStjtv*soGu47T`%!Y;}"><mutation name="eye"><arg name="eye_x"></arg><arg name="eye_y"></arg><arg name="size"></arg><arg name="open"></arg></mutation><value name="ARG0"><block type="math_arithmetic" id="[GHW2LMUlCFJ%-A5*gu?"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="r@Qc?1~VH?^tKs?zU}`j"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field></block></value><value name="B"><shadow type="math_number" id="RLYcP=Jlr1ah8DZDRR}h"><field name="NUM">30</field></shadow></value></block></value><value name="ARG1"><block type="variables_get" id="d_a2YxkT);QmrM/qiedC"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field></block></value><value name="ARG2"><block type="variables_get" id="i=KlH~MNpv6jUG5I6P+Y"><field name="VAR" id=":jB_!2oRo[fS2+yeTV^J">eyesize</field></block></value><value name="ARG3"><block type="variables_get" id="0+J%rb5P8zKIg8_Fljok"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field></block></value><next><block type="procedures_callnoreturn" id="~=`V{wxxxA|NjqtX}_V5"><mutation name="mouth"><arg name="mouth_x"></arg><arg name="mouth_y"></arg><arg name="mouth_width"></arg><arg name="mouth_height"></arg></mutation><value name="ARG0"><block type="variables_get" id="$!LCRy4mj_e5,FZSASHh"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field></block></value><value name="ARG1"><block type="variables_get" id="d!Ex3C}6kAjsy9;3qhN4"><field name="VAR" id="(f9*,gCVb%EBtX|vS4GY">mouthline</field></block></value><value name="ARG2"><block type="variables_get" id="y:l@*t1D}P4BZ@?w4WcL"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field></block></value><value name="ARG3"><block type="variables_get" id="0U`eJvNHusNq+90b*)h?"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field></block></value><next><block type="py_stmt" id="x3Q9-L$:9zM^@Q[7=}%F"><field name="STMT"># Nose</field><next><block type="display_blit" id="HlsC|O=9Dd?u?b*V(dtw"><field name="T">FALSE</field><value name="IMAGE"><block type="display_image" id="n8koVB!cZ`gJ$jLr@YP:"><field name="P00">FALSE</field><field name="P01">FALSE</field><field name="P02">FALSE</field><field name="P03">FALSE</field><field name="P04">FALSE</field><field name="P05">FALSE</field><field name="P06">FALSE</field><field name="P07">FALSE</field><field name="P10">FALSE</field><field name="P11">FALSE</field><field name="P12">FALSE</field><field name="P13">FALSE</field><field name="P14">FALSE</field><field name="P15">FALSE</field><field name="P16">FALSE</field><field name="P17">FALSE</field><field name="P20">FALSE</field><field name="P21">FALSE</field><field name="P22">FALSE</field><field name="P23">TRUE</field><field name="P24">TRUE</field><field name="P25">FALSE</field><field name="P26">FALSE</field><field name="P27">FALSE</field><field name="P30">FALSE</field><field name="P31">FALSE</field><field name="P32">TRUE</field><field name="P33">TRUE</field><field name="P34">TRUE</field><field name="P35">TRUE</field><field name="P36">FALSE</field><field name="P37">FALSE</field><field name="P40">FALSE</field><field name="P41">TRUE</field><field name="P42">TRUE</field><field name="P43">FALSE</field><field name="P44">FALSE</field><field name="P45">TRUE</field><field name="P46">TRUE</field><field name="P47">FALSE</field><field name="P50">TRUE</field><field name="P51">TRUE</field><field name="P52">FALSE</field><field name="P53">FALSE</field><field name="P54">FALSE</field><field name="P55">FALSE</field><field name="P56">TRUE</field><field name="P57">TRUE</field><field name="P60">TRUE</field><field name="P61">FALSE</field><field name="P62">FALSE</field><field name="P63">FALSE</field><field name="P64">FALSE</field><field name="P65">FALSE</field><field name="P66">FALSE</field><field name="P67">TRUE</field><field name="P70">FALSE</field><field name="P71">FALSE</field><field name="P72">FALSE</field><field name="P73">FALSE</field><field name="P74">FALSE</field><field name="P75">FALSE</field><field name="P76">FALSE</field><field name="P77">FALSE</field></block></value><value name="X"><shadow type="math_number" id="uqz{YE9vRQ[7#{szg-n^"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Do%r!?!RqBmIKzYyDN)J"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="pZHn|n/bff?~izA)N/J%"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field></block></value><value name="B"><shadow type="math_number" id="oqYU`:zMofnu,p{-Db/O"><field name="NUM">4</field></shadow></value></block></value><value name="Y"><shadow type="math_number" id="}E7:g2sTNYH%H`;6YbYP"><field name="NUM">0</field></shadow><block type="math_mult_add" id="hi;b)NJV+tTW0R_=sho2"><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="tnb#GyJzjPj+i]csRR~*"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field></block></value><value name="B"><shadow type="math_number" id="jOtgrz/NP^`4hvXwwIyV"><field name="NUM">2</field></shadow></value><value name="C"><shadow type="math_number" id="n568Q2QA;o}[8]Umc,n."><field name="NUM">-12</field></shadow></value></block></value><next><block type="py_stmt" id="JZl_c0`p1;?4*j!(n`7Q"><field name="STMT"># Vary eye and mouth sizes</field><next><block type="math_change" id="c1UwCDW*aiMjr~B;M$nQ"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="DELTA"><shadow type="math_number" id="wna;0:a:t2$A`2x_5R~{"><field name="NUM">1</field></shadow><block type="math_random_int" id=".oh:]r6~jz@WWOg+U!h)"><value name="FROM"><block type="math_number" id=")X[`!wbhv6f:R5P)m={("><field name="NUM">-1</field></block></value><value name="TO"><block type="math_number" id="bT{jDl=XlP}cJ_+Jl2(H"><field name="NUM">1</field></block></value></block></value><next><block type="variables_set" id="$N=TmbX,Po8AD,?Q8#go"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="VALUE"><block type="math_constrain" id="[IwTRgE,nugh@v3xb+|H"><value name="VALUE"><block type="variables_get" id=":#6mhrr1ys-5$nt5Fb!m"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field></block></value><value name="LOW"><block type="math_number" id="H=-^6`?#h@8P9Y9?pV=~"><field name="NUM">1</field></block></value><value name="HIGH"><block type="math_number" id="r(W6aoG;QF4nGE#Xr]aM"><field name="NUM">10</field></block></value></block></value><next><block type="math_change" id="|k)GVWvYZ5LeF4AO!}%:"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_random_int" id=",anD.B;KQ/0HOVBdej@`"><value name="FROM"><block type="math_number" id="]~ngt$)x3Gt{s]izb4ha"><field name="NUM">-1</field></block></value><value name="TO"><block type="math_number" id="ZMih[^HpKNO;}8Z0yqxF"><field name="NUM">1</field></block></value></block></value><next><block type="variables_set" id="i2T^;,0E74WF%orF!#AT"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="VALUE"><block type="math_constrain" id="N.KqsP+o-`w!HpFvCDV{"><value name="VALUE"><block type="variables_get" id="YwA1d]5h/}@);Ce7^Y%w"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field></block></value><value name="LOW"><block type="math_number" id="yRN7uuRl{k5-kS4EF2V4"><field name="NUM">2</field></block></value><value name="HIGH"><block type="math_number" id="b}ux|-LqfaHf!2QL7ClE"><field name="NUM">20</field></block></value></block></value><next><block type="math_change" id="8]hwI#eH(+58fdMSOXLh"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field><value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_random_int" id="{t~u^fW8^L,$hz;c[[gY"><value name="FROM"><block type="math_number" id="4.ON#ZRSx^6y#x({V?6e"><field name="NUM">-1</field></block></value><value name="TO"><block type="math_number" id="=46JcMcKu_niAW=Pn;P^"><field name="NUM">1</field></block></value></block></value><next><block type="variables_set" id=":!*m7:iAx!pHe[cx-bv}"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field><value name="VALUE"><block type="math_constrain" id="0iovcOZ0=4Fzq!8uKH1-"><value name="VALUE"><block type="variables_get" id="`sc.7koo)^sGZZe@V1lX"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field></block></value><value name="LOW"><block type="math_number" id="g4g+vL$39tlE|T-j9Dd#"><field name="NUM">20</field></block></value><value name="HIGH"><block type="math_number" id="mxsaJxEs%/qVo{FUxOBc"><field name="NUM">80</field></block></value></block></value><next><block type="py_stmt" id="LK_6SjHkxy{NrI@?f+#g"><field name="STMT"># Eye reopen after blink</field><next><block type="controls_if" id="pj_mFDlm*EPeD*~yJu{5"><value name="IF0"><block type="variables_get" id="}{6N[R5F9EklhC{9sK*L"><field name="VAR" id="wRjQ3Psu+M-$]}Zr(#fb">blink</field></block></value><statement name="DO0"><block type="variables_set" id=",E^jAQ({NA;-$!!`@*.:"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="VALUE"><block type="math_random_int" id="^ji(i(tmxaLccc+4DVl+"><value name="FROM"><block type="math_number" id="RRC*.RNikLM$rp*+3N_;"><field name="NUM">4</field></block></value><value name="TO"><block type="math_number" id="lqqC$`Y7=1;ZmUB(m*iN"><field name="NUM">10</field></block></value></block></value><next><block type="variables_set" id="#pDbBRaGcPb,K66t(M|."><field name="VAR" id="wRjQ3Psu+M-$]}Zr(#fb">blink</field><value name="VALUE"><block type="logic_boolean" id="y,rn79MnbeGV!xp2o!`%"><field name="BOOL">FALSE</field></block></value></block></next></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="event_on_start" id="a^xMAH0th$.eJS04(XU{" x="-270" y="-410"><statement name="DO"><block type="py_stmt" id="Dh_Rm[_QQrB9v2d{eA0j"><field name="STMT"># Demo of animated face on the Kookaberry display</field><next><block type="variables_set" id="$(h`XP7eOJN5!1*pztu."><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field><value name="VALUE"><block type="math_number" id="E1QN%3JNd.`=}Xn_nC:b"><field name="NUM">63</field></block></value><next><block type="variables_set" id="|$+}$7vnfR7O4Q$5C@,0"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field><value name="VALUE"><block type="math_number" id="CBKyrf*@hk`}w.,i`gDO"><field name="NUM">20</field></block></value><next><block type="variables_set" id="G~BIm=SG!S4e9=(#Lf*S"><field name="VAR" id=":jB_!2oRo[fS2+yeTV^J">eyesize</field><value name="VALUE"><block type="math_number" id="~Ya3=Qf|K{NWZ%o%N%^I"><field name="NUM">20</field></block></value><next><block type="variables_set" id="$X4fZV3ZH2%9tscC?T4/"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="VALUE"><block type="math_number" id="V8FO)l5D!R8yptKUcqH@"><field name="NUM">5</field></block></value><next><block type="variables_set" id="{Be?/f}Jp~tk)|4kwZSP"><field name="VAR" id="(f9*,gCVb%EBtX|vS4GY">mouthline</field><value name="VALUE"><block type="math_mult_add" id="C#H}|IhnY*m$Cug{H=16"><value name="A"><shadow type="math_number" id="26%u7Bz!m#86+%;;uIXB"><field name="NUM">1</field></shadow><block type="variables_get" id="2k`5gkJDOAY2})NGu.{c"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field></block></value><value name="B"><shadow type="math_number" id="_5$9z`Vbu]9h/4%c$f1Q"><field name="NUM">2</field></shadow></value><value name="C"><shadow type="math_number" id="aGWr)`5?RS|P9UNe^)AG"><field name="NUM">10</field></shadow></value></block></value><next><block type="variables_set" id="|ZKo2bLQ^SsZ9e~eu#Rl"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field><value name="VALUE"><block type="math_random_int" id="$K6cjBT=[..D`S]R?zH?"><value name="FROM"><block type="math_number" id="qpYDU$hR,bj(VhhXflZs"><field name="NUM">40</field></block></value><value name="TO"><block type="math_number" id="t1M4WfWeKWf~BHt,/oB-"><field name="NUM">80</field></block></value></block></value><next><block type="variables_set" id="t~GoghLD^gY}[*v?HYDL"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="VALUE"><block type="math_random_int" id="Ckd@ja4C:VBgt8Ff}=76"><value name="FROM"><block type="math_number" id="eOcUW.#H/)rA]OS?IRC)"><field name="NUM">4</field></block></value><value name="TO"><block type="math_number" id="ELW?H%VEfCDos8IlL99|"><field name="NUM">10</field></block></value></block></value><next><block type="variables_set" id="^HdM}=N18LW:r6$W/[6a"><field name="VAR" id="wRjQ3Psu+M-$]}Zr(#fb">blink</field><value name="VALUE"><block type="logic_boolean" id="Im(?jl]BKRm%3EtKoTR-"><field name="BOOL">FALSE</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="event_button_was_pressed" id="*P$]Sx(oMTM8pw^x3sye" x="990" y="-310"><field name="BUTTON">kooka.button_a.was_pressed()</field><statement name="DO"><block type="exit_program" id="3OZ1h?qCTA`L@Kx/`v:5"></block></statement></block><block type="event_button_is_pressed" id="egrB%=v4t0;4+FWOmQM1" x="990" y="-210"><field name="BUTTON">kooka.button_b.is_pressed()</field><statement name="DO"><block type="py_stmt" id="HcW-*te8oLc(4UAsz]|W"><field name="STMT"># Shut eyes</field><next><block type="variables_set" id="-v{6_oe$Z@blzbwH2k,E"><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="VALUE"><block type="math_number" id="}N2UMo6DG}}1v@%a9y9i"><field name="NUM">1</field></block></value><next><block type="variables_set" id="t(Z30W(}u#]Ot`c*8]+S"><field name="VAR" id="wRjQ3Psu+M-$]}Zr(#fb">blink</field><value name="VALUE"><block type="logic_boolean" id="5ugOWHD/M:tr~y8#_$Ys"><field name="BOOL">TRUE</field></block></value></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="o^htb;(p!~h-2OLQf_~V" x="-270" y="-70"><mutation><arg name="eye_x" varid="9Tpw+$=0;Xfr+/Ai74;z"></arg><arg name="eye_y" varid="d^XSX$WxYd6}37G^bX)2"></arg><arg name="size" varid="qM^|,5)KWdBlTMfN$@fl"></arg><arg name="open" varid="T{^.tTnN)^y#CZ_rl)yH"></arg></mutation><field name="NAME">eye</field><comment pinned="false" h="80" w="160">Draws an eye centred on x,y with given size and height proportioned on scale 0 to 10 (bounds not checked)</comment><statement name="STACK"><block type="variables_set" id="VX5;WBLiArR{Jh$tB}W3"><field name="VAR" id="Y`t|o([`J-Q@%j;JZsXt">eye_height</field><value name="VALUE"><block type="math_arithmetic" id="l,wzd/iCK_[Wn_YMi*wJ"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="ovEOZosdmV#C)`?{4o8{"><field name="NUM">1</field></shadow><block type="variables_get" id="fuoruV-WXwV9uMo24;+h"><field name="VAR" id="qM^|,5)KWdBlTMfN$@fl">size</field></block></value><value name="B"><shadow type="math_number" id="i9d*X^(]I`~A_z]#idFB"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="]/8Y!]j=1g^A[80V1*@d"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="(Ka/~/M[KJ$Wm4F8UVJh"><field name="VAR" id="T{^.tTnN)^y#CZ_rl)yH">open</field></block></value><value name="B"><shadow type="math_number" id="5lP8}DJTBQ#a6tKBbiAU"><field name="NUM">10</field></shadow></value></block></value></block></value><next><block type="display_rect_v2" id="9H@qbF#z]@J4P#47(;Y0"><field name="F">TRUE</field><field name="R">FALSE</field><value name="X"><shadow type="math_number" id="{`F{l7YM6UOwFP_[L;*)"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="9T*w(4}HN5{@h#t8bX#P"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="d[qa{|1C_E`)I],rd34$"><field name="NUM">1</field></shadow><block type="variables_get" id="(qK0yT#zVFJFO-+yqj:]"><field name="VAR" id="9Tpw+$=0;Xfr+/Ai74;z">eye_x</field></block></value><value name="B"><shadow type="math_number" id="K*}TI[fu@sT8$uCp?+ko"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="zY:@fXUGqgb^|7.V6,Sc"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="CV9oV/y=,Z:wjK.JP%W6"><field name="NUM">1</field></shadow><block type="variables_get" id="-X!xNV|?tJ[Pm|i3y|YR"><field name="VAR" id=":jB_!2oRo[fS2+yeTV^J">eyesize</field></block></value><value name="B"><shadow type="math_number" id="SyX!;UEWVY(g-ro8!1z+"><field name="NUM">2</field></shadow></value></block></value></block></value><value name="Y"><shadow type="math_number" id="hGS:JioOFEpyDRY1K5vS"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="nOe!`[;2Z:7?/L(fROkv"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id=",BH*McKAZrt]LT%IeC1S"><field name="VAR" id="/5^,BEX?]n+UK+fC34ib">eyeline</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="8a4@]{StSZURAP,ZHv)C"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="kv::j,?ewX6=)q5aDy3m"><field name="VAR" id="Y`t|o([`J-Q@%j;JZsXt">eye_height</field></block></value><value name="B"><shadow type="math_number" id="5=XRPX[$Z|}CaKA^pzd("><field name="NUM">2</field></shadow></value></block></value></block></value><value name="W"><shadow type="math_number" id="61fdmcP*Nh)v;_E/DJmH"><field name="NUM">10</field></shadow><block type="variables_get" id=",f^v1^_fquLNQ6lnuF$~"><field name="VAR" id="qM^|,5)KWdBlTMfN$@fl">size</field></block></value><value name="H"><shadow type="math_number" id="{SMN/`,+MEy){GbbD]ZM"><field name="NUM">10</field></shadow><block type="variables_get" id="K:pQ~+Vrpw~%59sKyt2Q"><field name="VAR" id="Y`t|o([`J-Q@%j;JZsXt">eye_height</field></block></value><value name="C"><shadow type="math_number" id=")#2^gJ*b:4l_mLW@2+E8"><field name="NUM">1</field></shadow></value></block></next></block></statement></block><block type="event_button_was_pressed" id="/RSvEQk:zjPaNLq8!clA" x="990" y="-70"><field name="BUTTON">kooka.button_c.was_pressed()</field><statement name="DO"><block type="py_stmt" id="c1J/cWC6o#A-YWY*i8?j"><field name="STMT"># Close and iden mouth</field><next><block type="variables_set" id="ZaB{9)39my5=aas-Erjc"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="VALUE"><block type="math_number" id="v#1R3$dePm!,;2AFO~J@"><field name="NUM">2</field></block></value><next><block type="variables_set" id="CA9BW9Cm_p^wPF+dVyQ#"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field><value name="VALUE"><block type="math_number" id="QAfFKazfj_uM5]S+%q`R"><field name="NUM">60</field></block></value></block></next></block></next></block></statement></block><block type="event_button_was_pressed" id="#9{;l$rRfIWVQ;f59{Wi" x="990" y="90"><field name="BUTTON">kooka.button_d.was_pressed()</field><statement name="DO"><block type="py_stmt" id="F8?B23FU|Q|KZx^fzel8"><field name="STMT"># Open and narrow mouth</field><next><block type="variables_set" id="[+pFP}y}Lc`VnW==#b(`"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="VALUE"><block type="math_number" id="$$9DcId%h)L`;-n)3qvQ"><field name="NUM">10</field></block></value><next><block type="variables_set" id="xI=H^(KkJ{`z[_%HDJBE"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field><value name="VALUE"><block type="math_number" id="@`B{tyB)Mj;7x[jhc,Iy"><field name="NUM">30</field></block></value></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="R*9Xc4_,*sGBD`vKz`-?" x="-270" y="230"><mutation><arg name="mouth_x" varid="Aj`^$Vtd:l01Uf%/juJx"></arg><arg name="mouth_y" varid="a,~k2=n`Wu9ZY8}7:!J|"></arg><arg name="mouth_width" varid="-cBD?D[O-K`jKumv{qdB"></arg><arg name="mouth_height" varid="C#5V|8O/55}3:DRqpnpW"></arg></mutation><field name="NAME">mouth</field><comment pinned="false" h="80" w="160">Draws the mouth centred on x,y with given width and height</comment><statement name="STACK"><block type="display_rect_v2" id="7m%NnT82uP4`A%Iw_*pK"><field name="F">FALSE</field><field name="R">FALSE</field><value name="X"><shadow type="math_number" id=")0BfXWjUU(B-sVm53-%X"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="J0Wn`c$qiwy}=RRu=3oQ"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="M9=~m.7br3EC5m7p}z-("><field name="NUM">1</field></shadow><block type="variables_get" id="mG[40u^zeV^5Wv^vTd~u"><field name="VAR" id="Aj`^$Vtd:l01Uf%/juJx">mouth_x</field></block></value><value name="B"><shadow type="math_number" id="u3I(AqJ9_!x:0RSS:H{`"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="=.:WL#`[a5A5L+h*T:rL"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number" id="(EFsZXhQQ|:sz4`~ik6O"><field name="NUM">1</field></shadow><block type="variables_get" id="6=oE9?T}t46UY+6oH/kp"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field></block></value><value name="B"><shadow type="math_number" id="`PjSF*E;8kJ;p;x[KW$/"><field name="NUM">2</field></shadow></value></block></value></block></value><value name="Y"><shadow type="math_number" id="(f}0/nI?,jh3@,m5|Bqj"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="pNujd:)!TcnA4Gnl@F31"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="i=d{6gyrovq9xmO9L$T%"><field name="VAR" id="a,~k2=n`Wu9ZY8}7:!J|">mouth_y</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_arithmetic" id="Ni`QPQ,Rwb46D/]Q+Jr!"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="variables_get" id="qgl*,wW2]KijgY:NOq0x"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field></block></value><value name="B"><shadow type="math_number" id="6^cW;*st,1YPh4;[p~#3"><field name="NUM">2</field></shadow></value></block></value></block></value><value name="W"><shadow type="math_number" id="/b^Ls}G.u,aB%zJf$bLo"><field name="NUM">10</field></shadow><block type="variables_get" id="dt0oBHeGL^lM`L7@aPJz"><field name="VAR" id="-cBD?D[O-K`jKumv{qdB">mouth_width</field></block></value><value name="H"><shadow type="math_number" id="sLh|D??5jF;O.oZ_SOm}"><field name="NUM">10</field></shadow><block type="variables_get" id="u8Mw)YB7G0NOX9.]W?Oo"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field></block></value><value name="C"><shadow type="math_number" id="3m$m+c#q;;+m7ZZRh~Y*"><field name="NUM">1</field></shadow></value></block></statement></block><block type="event_every_seconds" id="T_,`xgz0S/K15_28~5$T" x="-270" y="490"><field name="T">10</field><statement name="DO"><block type="py_stmt" id="fX^p98ASgGeQZb8dXS#}"><field name="STMT"># Blink</field><next><block type="variables_set" id="TMqqAcwnJnP(MCH+}Lg."><field name="VAR" id="v2J~`+U)~_X|nXPga9@}">eye_open</field><value name="VALUE"><block type="math_number" id="2o}Y:MLS2^Ofyr.u%0K`"><field name="NUM">1</field></block></value><next><block type="variables_set" id="!Ej}cyL/g][xKc{*?SLg"><field name="VAR" id="wRjQ3Psu+M-$]}Zr(#fb">blink</field><value name="VALUE"><block type="logic_boolean" id="KZ*lrwyYb|%cAz#2rL$k"><field name="BOOL">TRUE</field></block></value></block></next></block></next></block></statement></block><block type="event_every_seconds" id="AW$98PdSgf}5WReFwfSq" x="30" y="490"><field name="T">15</field><statement name="DO"><block type="py_stmt" id="q5LOqnt1D).cCt=13Tg?"><field name="STMT"># Shut mouth</field><next><block type="variables_set" id="WB`O(#X+9TLO`.:|%~)b"><field name="VAR" id="C#5V|8O/55}3:DRqpnpW">mouth_height</field><value name="VALUE"><block type="math_number" id="P7z4ypOL1V6?6%3{-g-!"><field name="NUM">2</field></block></value></block></next></block></statement></block><block type="event_every_seconds" id="0+^8srLDSv:bF5D$.fw9" x="-270" y="630"><field name="T">0.8</field><statement name="DO"><block type="py_stmt" id="?TsE[/u-Ma@f=Iygbyls"><field name="STMT"># Vary direction of gaze</field><next><block type="math_change" id="!u]%,2X7%]GarC=4tqC,"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field><value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow><block type="math_random_int" id="[IX@d7.24c21`e5NU!TV"><value name="FROM"><block type="math_number" id="4;_vDe$)PyP6i|oP!)MG"><field name="NUM">-1</field></block></value><value name="TO"><block type="math_number" id="M)8oj-?*1$*6%dn=j,lY"><field name="NUM">1</field></block></value></block></value><next><block type="variables_set" id="$zBB}?iB!@]shzTSSrY,"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field><value name="VALUE"><block type="math_constrain" id="!eWGY[E:kOb$=%(M~Xv6"><value name="VALUE"><block type="variables_get" id="bal$~:dl1[#P24nh|fXb"><field name="VAR" id="G[5ha:Ck}e,Itu,wcpP6">face_midline</field></block></value><value name="LOW"><block type="math_number" id="AS{%(%j/81~]@EhX:wp,"><field name="NUM">53</field></block></value><value name="HIGH"><block type="math_number" id="!-qj#18~,p5tk!q!:8:1"><field name="NUM">73</field></block></value></block></value></block></next></block></next></block></statement></block></xml>
